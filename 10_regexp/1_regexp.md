# Регулярные выражения в bash

## Что такое регулярные выражения

Регулярные выражения (regex) - это мощный инструмент для поиска и обработки текста, который позволяет описывать шаблоны для поиска строк. Они широко используются в Unix-подобных системах для фильтрации, поиска и замены текста.

## Типы регулярных выражений

В Unix-подобных системах используются два основных типа регулярных выражений:

1. POSIX Basic Regular Expressions (BRE)
2. POSIX Extended Regular Expressions (ERE)

## Регулярные выражения POSIX BRE

### Специальные символы

```bash
# Базовые специальные символы
.       # Любой одиночный символ
*       # Ноль или более повторений предыдущего символа
^       # Начало строки
$       # Конец строки
[]      # Класс символов
[^]     # Отрицание класса символов
\       # Экранирование специальных символов
```

### Якорные символы

```bash
# Примеры использования якорных символов
^test   # Строка начинается с "test"
test$   # Строка заканчивается на "test"
^test$  # Строка точно равна "test"
```

### Символ «точка»

```bash
# Примеры использования точки
t.st    # Соответствует: test, t1st, t@st и т.д.
t..t    # Соответствует: test, t12t, t@#t и т.д.
```

### Классы символов

```bash
# Примеры классов символов
[abc]   # Любой из символов a, b или c
[0-9]   # Любая цифра
[a-z]   # Любая строчная буква
[A-Z]   # Любая заглавная буква
```

### Отрицание классов символов

```bash
# Примеры отрицания классов
[^abc]  # Любой символ, кроме a, b или c
[^0-9]  # Любой символ, кроме цифр
```

### Диапазоны символов

```bash
# Примеры диапазонов
[a-z]   # Все строчные буквы
[A-Z]   # Все заглавные буквы
[0-9]   # Все цифры
[a-zA-Z] # Все буквы
```

### Специальные классы символов

```bash
# Предопределенные классы
[:alnum:]  # Буквенно-цифровые символы
[:alpha:]  # Буквенные символы
[:digit:]  # Цифры
[:lower:]  # Строчные буквы
[:upper:]  # Заглавные буквы
[:space:]  # Пробельные символы
```

### Символ «звёздочка»

```bash
# Примеры использования звездочки
te*st    # Соответствует: tst, test, teest, teeeest и т.д.
[0-9]*   # Ноль или более цифр
```

## Регулярные выражения POSIX ERE

### Вопросительный знак

```bash
# Примеры использования вопросительного знака
te?st    # Соответствует: tst или test
colou?r  # Соответствует: color или colour
```

### Символ плюс

```bash
# Примеры использования плюса
te+st    # Соответствует: test, teest, teeeest (но не tst)
[0-9]+   # Одна или более цифр
```

### Фигурные скобки

```bash
# Примеры использования фигурных скобок
te{2}st  # Соответствует: teest
te{2,4}st # Соответствует: teest, teeest, teeeest
te{2,}st  # Два или более повторений
```

### Символ логического «или»

```bash
# Примеры использования логического ИЛИ
test|exam # Соответствует: test или exam
(red|blue) # Соответствует: red или blue
```

### Группировка фрагментов регулярных выражений

```bash
# Примеры группировки
(te)+st  # Соответствует: test, tetest, tetetest
(red|blue) ball # Соответствует: red ball или blue ball
```

## Практические примеры

### Подсчёт количества файлов

```bash
#!/bin/bash

# Подсчет файлов с определенным расширением
count=$(ls | grep -c '\.txt$')

# Подсчет файлов, начинающихся с определенной буквы
count=$(ls | grep -c '^[Aa]')

# Подсчет файлов с определенным паттерном в имени
count=$(ls | grep -c '[0-9]\{3\}')
```

### Проверка адресов электронной почты

```bash
#!/bin/bash

# Простая проверка email
if [[ $email =~ ^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$ ]]; then
    echo "Валидный email"
else
    echo "Невалидный email"
fi
```

## Практическое задание

Создайте скрипт `regex_demo.sh`:

```bash
#!/bin/bash

# Создание тестового файла
cat > test.txt << EOF
test@example.com
invalid-email
123-456-7890
(123) 456-7890
test.txt
data.csv
EOF

echo "=== Проверка email адресов ==="
grep -E '^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$' test.txt

echo -e "\n=== Поиск телефонных номеров ==="
grep -E '^\(?[0-9]{3}\)?[ -]?[0-9]{3}[ -]?[0-9]{4}$' test.txt

echo -e "\n=== Поиск файлов с определенным расширением ==="
grep '\.(txt|csv)$' test.txt
```

## Итоги

- Регулярные выражения - мощный инструмент для работы с текстом
- BRE и ERE предоставляют разные уровни функциональности
- Специальные символы позволяют создавать сложные паттерны
- Регулярные выражения широко используются в Unix-системах
- Практика важна для освоения регулярных выражений

## Дополнительные материалы

- [Regular Expressions in Bash](https://www.gnu.org/software/bash/manual/bash.html#Pattern-Matching)
- [POSIX Regular Expressions](https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap09.html)

## Вопросы для самопроверки

1. В чем разница между BRE и ERE?
2. Как использовать классы символов?
3. Что такое квантификаторы?
4. Как работает группировка в регулярных выражениях?
5. Как проверить валидность email с помощью регулярных выражений?
